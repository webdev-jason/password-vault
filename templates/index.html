<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Password Vault</title>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=1">
    
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icon.png') }}">

    <style>
        .edit-mode-inputs { display: flex; flex-direction: column; gap: 5px; width: 100%; }
        .edit-mode-inputs input { padding: 8px; font-size: 0.9rem; }
        .footer { text-align: center; margin-top: 30px; font-size: 0.8rem; color: var(--text-muted); }
        .footer a { color: var(--text-muted); text-decoration: none; }
        .footer a:hover { color: var(--primary); text-decoration: underline; }
        .header-actions { display: flex; gap: 15px; font-size: 0.9rem; align-items: center; }
        .link-btn { background: none; border: none; color: var(--text-muted); cursor: pointer; text-decoration: underline; padding: 0; font-size: 0.9rem; }
        .link-btn:hover { color: var(--primary); }
    </style>
</head>
<body>

    <div class="app-container">
        
        <div id="login-section" class="card">
            <h2>üîê Password Vault</h2>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 2rem;">Enter credentials to unlock</p>
            <div class="input-group">
                <label>Username</label>
                <input type="text" id="login-user" autocomplete="off" autocapitalize="off" autocorrect="off">
            </div>
            <div class="input-group">
                <label>Password</label>
                <div class="password-wrapper">
                    <input type="password" id="login-pass">
                    <button class="btn-eye" onclick="togglePassword('login-pass', this)" type="button">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                </div>
            </div>
            <div class="input-group">
                <label>2FA Code</label>
                <input type="text" id="login-code" placeholder="000 000" maxlength="6" style="text-align: center; letter-spacing: 2px;">
            </div>
            <button class="btn btn-primary" onclick="attemptLogin()">Unlock Vault</button>
            <div id="error-msg" class="text-error"></div>
            
            <p class="footer" style="margin-top:20px; font-size:0.9rem;">
                New here? <button class="link-btn" onclick="toggleRegister()">Create Account</button>
            </p>
        </div>

        <div id="register-section" class="card hidden">
            <h2>Create Account</h2>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 2rem;">Set up your secure vault</p>
            
            <div class="input-group">
                <label>New Username</label>
                <div style="position:relative;">
                    <div id="user-bubble" class="validation-bubble">Invalid character detected (space, quotes, \, ;, {}, [], |)</div>
                    <input type="text" id="reg-user" autocapitalize="off" autocorrect="off">
                </div>
            </div>
            <div class="input-group">
                <label>New Password</label>
                <div class="password-wrapper">
                    <div id="reg-bubble" class="validation-bubble">Invalid character detected (space, quotes, \, ;, {}, [], |)</div>
                    <input type="password" id="reg-pass">
                    <button class="btn-eye" onclick="togglePassword('reg-pass', this)" type="button">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                </div>
            </div>
            <div class="input-group">
                <label>Confirm Password</label>
                <div class="password-wrapper">
                    <input type="password" id="reg-pass-confirm">
                    <button class="btn-eye" onclick="togglePassword('reg-pass-confirm', this)" type="button">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                </div>
            </div>

            <button class="btn btn-primary" onclick="registerUser()">Create Account</button>
            <button class="btn btn-danger" onclick="toggleRegister()" style="margin-top: 10px; color: var(--text-main);">Cancel</button>
            <div id="reg-error" class="text-error"></div>
        </div>

        <div id="setup-2fa-section" class="card hidden">
            <h2>Setup 2FA</h2>
            <p style="text-align: center; color: var(--text-muted); font-size: 0.9rem;">
                Use <strong>Google Authenticator</strong> or similar app.
            </p>
            
            <div style="text-align: center; margin: 20px 0;">
                <img id="qr-image" src="" alt="QR Code" style="border: 4px solid white; border-radius: 8px; width: 180px; height: 180px;">
            </div>

            <a id="otp-link" href="#" class="btn" style="background-color: var(--surface); color: var(--primary); border: 1px solid var(--primary); margin-bottom: 20px; text-decoration: none;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect><line x1="12" y1="18" x2="12.01" y2="18"></line></svg>
                Tap to Setup (Mobile)
            </a>

            <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 20px;">
                <p id="secret-code-display" style="font-family: monospace; font-size: 1rem; letter-spacing: 1px; font-weight: bold; color: var(--text-main); margin:0;"></p>
                <button class="btn-icon" onclick="copySecret()" title="Copy Secret" style="background: #e5e7eb; border-radius: 4px; padding: 6px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                </button>
            </div>

            <button class="btn btn-primary" onclick="finishRegistration()">I have scanned it (Go to Login)</button>
        </div>

        <div id="vault-section" class="hidden">
            <div class="header-row">
                <h2><span id="header-username">My</span> Passwords</h2>
                <div class="header-actions">
                    <button onclick="toggleSettings()" class="link-btn">Account</button>
                    <button onclick="logout()" class="link-btn">Log Out</button>
                </div>
            </div>

            <div id="settings-card" class="card hidden" style="border-left: 5px solid var(--primary);">
                <h3 style="margin-top:0;">Account Management</h3>
                <p style="font-size:0.9rem; color:var(--text-muted); margin-bottom: 1rem;">Update credentials. Leave blank to keep unchanged.</p>
                
                <div class="input-group">
                    <label>New Username</label>
                    <input type="text" id="set-new-user" autocapitalize="off" autocorrect="off">
                </div>
                <div class="input-group">
                    <label>New Password</label>
                    <div class="password-wrapper">
                        <div id="pass-bubble" class="validation-bubble">Invalid character detected (space, quotes, \, ;, {}, [], |)</div>
                        <input type="password" id="set-new-pass">
                        <button class="btn-eye" onclick="togglePassword('set-new-pass', this)" type="button">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        </button>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="updateAccount()">Update Account</button>
                <button class="btn btn-danger" onclick="toggleSettings()" style="margin-top: 10px; color: var(--text-main);">Cancel</button>

                <hr style="margin: 20px 0; border: 0; border-top: 1px solid var(--border);">
                <div style="text-align: center;">
                    <button onclick="deleteAccount()" style="background: none; border: 1px solid var(--danger); color: var(--danger); padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">Delete Account</button>
                </div>
            </div>

            <div id="dashboard-view">
                <div class="card" id="add-card">
                    <div class="input-group"><input type="text" id="new-site" placeholder="Website (e.g. Netflix)"></div>
                    <div class="input-group"><input type="text" id="new-user" placeholder="Username / Email" autocapitalize="off" autocorrect="off"></div>
                    <div class="input-group" style="display: flex; gap: 8px;">
                        <div class="password-wrapper" style="flex-grow: 1;">
                            <input type="password" id="new-pass" placeholder="Password">
                            <button class="btn-eye" onclick="togglePassword('new-pass', this)" type="button">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                            </button>
                        </div>
                        <button class="btn btn-generate" onclick="generateRandomPassword()" title="Generate Random">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <path d="M16 8h.01"></path><path d="M16 12h.01"></path><path d="M16 16h.01"></path>
                            <path d="M8 8h.01"></path><path d="M8 12h.01"></path><path d="M8 16h.01"></path>
                            </svg>
                        </button>
                    </div>
                    <button class="btn btn-primary" onclick="addPassword()">Save Password</button>
                </div>

                <div class="input-group" style="margin-bottom: 15px;">
                    <input type="text" id="search-filter" placeholder="Search by website..." onkeyup="filterPasswords()" autocomplete="off">
                </div>

                <div id="password-list"></div>
            </div>
        </div>

        <div class="footer">
            <a href="/privacy" target="_blank">Privacy Policy</a>
            <span style="margin: 0 5px;">‚Ä¢</span>
            <span>Password Vault ¬© 2025</span>
        </div>
    </div>

    <div id="timeout-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3>Are you still there?</h3>
            <p style="color: var(--text-muted); margin-bottom: 20px;">
                You will be logged out in <span id="countdown-timer" style="font-weight: bold; color: var(--primary);">60</span> seconds due to inactivity.
            </p>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="stayLoggedIn()">Stay Logged In</button>
                <button class="btn btn-danger" onclick="logout()" style="color: var(--danger); border: 1px solid var(--border);">Log Out</button>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3>Are you sure?</h3>
            <p id="confirm-text" style="color: var(--text-muted); margin-bottom: 20px;">This action cannot be undone.</p>
            <div class="modal-actions" style="justify-content: center;">
                <button onclick="closeConfirm()" class="btn" style="background: transparent; color: var(--text-muted); border: 1px solid var(--border); width: auto; margin-right: 10px;">Cancel</button>
                <button onclick="performConfirm()" class="btn" style="background-color: var(--danger); color: white; width: auto;">Yes, Proceed</button>
            </div>
        </div>
    </div>

    <div id="prompt-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 id="prompt-title">Authentication Required</h3>
            <p id="prompt-text" style="color: var(--text-muted); margin-bottom: 15px;">Please enter your password:</p>
            <div class="input-group">
                <div class="password-wrapper">
                    <input type="password" id="prompt-input" placeholder="Password">
                    <button class="btn-eye" onclick="togglePassword('prompt-input', this)" type="button">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                </div>
            </div>
            <div class="modal-actions" style="justify-content: center;">
                <button onclick="closePrompt()" class="btn" style="background: transparent; color: var(--text-muted); border: 1px solid var(--border); width: auto; margin-right: 10px;">Cancel</button>
                <button onclick="performPrompt()" class="btn btn-primary" style="width: auto;">Confirm</button>
            </div>
        </div>
    </div>

    <div id="alert-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 id="alert-title">Success</h3>
            <p id="alert-text" style="color: var(--text-muted); margin-bottom: 20px;"></p>
            <div class="modal-actions" style="justify-content: center;">
                <button onclick="closeAlert()" class="btn btn-primary" style="width: auto; padding: 8px 24px;">OK</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}?v=1"></script>
</body>
</html>