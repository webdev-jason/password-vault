<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Password Vault</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=1">
    <style>
        .edit-mode-inputs { display: flex; flex-direction: column; gap: 5px; width: 100%; }
        .edit-mode-inputs input { padding: 8px; font-size: 0.9rem; }
        .footer { text-align: center; margin-top: 30px; font-size: 0.8rem; color: var(--text-muted); }
        .footer a { color: var(--text-muted); text-decoration: none; }
        .footer a:hover { color: var(--primary); text-decoration: underline; }
        .header-actions { display: flex; gap: 15px; font-size: 0.9rem; align-items: center; }
        .link-btn { background: none; border: none; color: var(--text-muted); cursor: pointer; text-decoration: underline; padding: 0; font-size: 0.9rem; }
        .link-btn:hover { color: var(--primary); }
    </style>
</head>
<body>

    <div class="app-container">
        
        <div id="login-section" class="card">
            <h2>üîê Password Vault</h2>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 2rem;">Enter credentials to unlock</p>
            <div class="input-group">
                <label>Username</label>
                <input type="text" id="login-user" autocomplete="off" autocapitalize="off" autocorrect="off">
            </div>
            <div class="input-group">
                <label>Password</label>
                <div class="password-wrapper">
                    <input type="password" id="login-pass">
                    <button class="btn-eye" onclick="togglePassword('login-pass', this)" type="button">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                </div>
            </div>
            <div class="input-group">
                <label>2FA Code</label>
                <input type="text" id="login-code" placeholder="000 000" maxlength="6" style="text-align: center; letter-spacing: 2px;">
            </div>
            <button class="btn btn-primary" onclick="attemptLogin()">Unlock Vault</button>
            <div id="error-msg" class="text-error"></div>
        </div>

        <div id="vault-section" class="hidden">
            <div class="header-row">
                <h2><span id="header-username">My</span> Passwords</h2>
                <div class="header-actions">
                    <button onclick="toggleSettings()" class="link-btn">Settings</button>
                    <button onclick="logout()" class="link-btn">Log Out</button>
                </div>
            </div>

            <div id="settings-card" class="card hidden" style="border-left: 5px solid var(--primary);">
                <h3 style="margin-top:0;">Account Settings</h3>
                <p style="font-size:0.9rem; color:var(--text-muted); margin-bottom: 1rem;">Update credentials. Leave blank to keep unchanged.</p>
                
                <div class="input-group">
                    <label>New Username</label>
                    <input type="text" id="set-new-user" autocapitalize="off" autocorrect="off">
                </div>
                <div class="input-group">
                    <label>New Password</label>
                    <div class="password-wrapper">
                        <div id="pass-bubble" class="validation-bubble">Invalid character detected (space, quotes, \, ;, {}, [], |)</div>
                        
                        <input type="password" id="set-new-pass">
                        <button class="btn-eye" onclick="togglePassword('set-new-pass', this)" type="button">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        </button>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="updateAccount()">Update Account</button>
                <button class="btn btn-danger" onclick="toggleSettings()" style="margin-top: 10px; color: var(--text-main);">Cancel</button>
            </div>

            <div class="card" id="add-card">
                <div class="input-group"><input type="text" id="new-site" placeholder="Website (e.g. Netflix)"></div>
                <div class="input-group"><input type="text" id="new-user" placeholder="Username / Email" autocapitalize="off" autocorrect="off"></div>
                <div class="input-group" style="display: flex; gap: 8px;">
                    <div class="password-wrapper" style="flex-grow: 1;">
                        <input type="password" id="new-pass" placeholder="Password">
                        <button class="btn-eye" onclick="togglePassword('new-pass', this)" type="button">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        </button>
                    </div>
                    <button class="btn btn-generate" onclick="generateRandomPassword()" title="Generate Random">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><circle cx="16" cy="8" r="2"></circle><circle cx="8" cy="16" r="2"></circle><circle cx="8" cy="8" r="2"></circle><circle cx="16" cy="16" r="2"></circle><circle cx="12" cy="12" r="2"></circle></svg>
                    </button>
                </div>
                <button class="btn btn-primary" onclick="addPassword()">Save Password</button>
            </div>

            <div id="password-list"></div>
        </div>

        <div class="footer">
            <a href="/privacy" target="_blank">Privacy Policy</a>
            <span style="margin: 0 5px;">‚Ä¢</span>
            <span>Password Vault ¬© 2025</span>
        </div>
    </div>

    <div id="timeout-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3>Are you still there?</h3>
            <p style="color: var(--text-muted); margin-bottom: 20px;">
                You will be logged out in <span id="countdown-timer" style="font-weight: bold; color: var(--primary);">60</span> seconds due to inactivity.
            </p>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="stayLoggedIn()">Stay Logged In</button>
                <button class="btn btn-danger" onclick="logout()" style="color: var(--danger); border: 1px solid var(--border);">Log Out</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}?v=1"></script>
</body>
</html>